#include <89c51rd2.h>	
#include <stdio.h>

#define LED1 P0_0
#define LED2 P0_1
#define LED3 P0_2
#define LED4 P0_3
#define LED5 P0_4
#define LED6 P0_5

#define BUZZER  P0_6
#define START  P0_7


#define ARTIBES P1_0
#define EKSIBES P1_1
#define MOD2 P1_2
#define MOD3 P1_3
#define MOD4 P1_4
#define MOD5 P1_5
#define MOD6 P1_6



void delay(int);
void yazdir(unsigned char x);

unsigned char sure=0;
unsigned char saydir;  //saydir'i time Kesmesi gelince kullanacagiz.
		
void delay(int k)
{
  int i,j;
  for(i=0;i<k;i++)
  {
    for(j=0;j<100;j++)
    {}
  }
}

void modsecim()
{
		if(MOD6==0)    				//Mod6 seçimi
			{
			LED1=1;
			LED2=1;
			LED3=1;
			LED4=1;
			LED5=1;
			LED6=1;
			}
			
		else if(MOD5==0)   	//Mod 5 seçimi
			{
			LED1=1;
			LED2=1;
			LED3=1;
			LED4=1;
			LED5=1;
			}
		
		else if(MOD4==0)    //Mod4 seçimi
			{
			LED1=1;
			LED2=1;
			LED3=1;
			LED4=1;
			}
			
		else if(MOD3==0)    //Mod3 seçimi
			{
			LED1=1;
			LED2=1;
			LED3=1;
			}
			
		else	if(MOD2==0)		//Mod2 seçimi
			{
			LED1=1;
			LED2=1;
			}
			
			else
				LED1=1;					//Hiçbir mod seçilmediyse Mikrodalga acilista en düsük güce ayarlanir.
			
			return;		
}
		
void yazdir(unsigned char x)
{
	SBUF=x;
	while(TI==0);
	TI=0;
}

void surebitti() interrupt 1      
{
	TR0=0; 			
	saydir++;
	TH0=0xC3;			//50ms için yükleme degeri
	TL0=0x50;			//50ms için yükleme degeri

	if(saydir==sure*20)     // Sure kadar zaman gecmisse
	{
			yazdir('I');
			P1_7=1;
			P1_7=0;
			yazdir('S');
			P1_7=1;
			P1_7=0;
			yazdir('L');
			P1_7=1;
			P1_7=0;
			yazdir('E');
			P1_7=1;
			P1_7=0;
			yazdir('M');
			P1_7=1;
			P1_7=0;
			yazdir(' ');
			P1_7=1;
			P1_7=0;
			yazdir('T');
			P1_7=1;
			P1_7=0;
			yazdir('A');
			P1_7=1;
			P1_7=0;
			yazdir('M');
			P1_7=1;
			P1_7=0;
			yazdir('A');
			P1_7=1;
			P1_7=0;
			yazdir('M');
			
	}
	else									//sure kadar saymadiysa tekrar 50ms'lik kesme bekle
	{
		goto cik;
	}
		
		cik: 
			yazdir('I');
			yazdir('S');
			yazdir('L');
			yazdir('E');
			yazdir('M');
			yazdir(' ');
			yazdir('D');
			yazdir('E');
			yazdir('V');
			yazdir('A');
			yazdir('M');
			yazdir(' ');
			yazdir('E');
			yazdir('D');
			yazdir('I');
			yazdir('Y');
			yazdir('O');
			yazdir('R');
}

void main()
{
	TMOD=0x90;   // Timer-1 Mod2 (baud rate için) ------  Timer-0, Mod-1 16bit (zamanlayici için)
	
	SCON=0x40;		// ; MOD-1 8bit UART degisken baud rate seçimi.
	TH1=0xFF;			// 9600 baud rate for 11.0592MHz
	TL1=0xFD;			// 9600 baud rate for 11.0592MHz
	TR1=1;
	
	TH0=0xC3;			//50ms için yükleme degeri
	TL0=0x50;			//50ms için yükleme degeri
	TR0=1;				//Zamanlayici 0 baslasin
	
	ET0=1;      // Zamanlayici 0 kesme yetkilendirme biti
	EA=1;				//Genel kesme yetkilendirme biti

	BUZZER=0;   //Buzzeri susturma.
	
	suresecme:					//Sürekli Starta basildi mi kontrol ediyoruz. Baslangicta bütün port girisleri FF oldugu için, butona basmak = bitin 0 olmasi.
	
		if(START==1)			 // baslatmaya basilmadi	
		{
				if(ARTIBES==0)    //sureyi 5 saniye arttirma
						sure=sure+5;

				else if(EKSIBES==0)    //sureyi 5 saniye azaltma
						{
									if (sure==0)      //sure 0'da azaltilmak istenirse yine 0 olarak ayarlanacak.
											sure=0;
									else
											sure=sure-5;
						}
				else 
					goto suresecme;        // Süre arttirma veya azaltmaya basilmadiysa suresecme etiketine dallan ve yapilanlari tekrarla.
					 
		}
		
		else if(START==1)  //Baslatmaya basildi
		{
			goto suresectinmodsec;
		}
	
		suresectinmodsec:		
		modsecim();   		//MOD SECMEYE GONDERILDI
		
		P2=0x01; //0001
    delay(1000);
    P2=0x04; //0100
    delay(1000);
    P2=0x02; //0010
    delay(1000);
    P2=0x08; //1000
    delay(1000);
		
		saydir=0;
		
		while(1){}
		
	}	
