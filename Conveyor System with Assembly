//  Bant hızı sabit olan bir konveyör sisteminde geçen kutular uzunluklarına(geçiş süresi) göre sınıflandırılmaktadır.
//  Kutu boyu 50ms ve altı A sınıfı (P2.0 üzerinden bir adet darbe üretilecektir), 
//  Kutu boyu 50ms üzeri ise B sınıfıdır(P2.1 üzerinden bir adet darbe üretilecektir).
//  Gerekli assembly programını kesme ISR kullanarak gerçekleştiriniz.


ORG		0000H
	SJMP	BASLA 
	ORG		0013H
	AJMP    HARICI1ISR
	ORG		001BH
	AJMP	TIMER1ISR

BASLA:	MOV		TMOD,#10010000B ; TIMER1, 16BITLIK MOD1, DISARDAN GELEN P3.3=1 ILE CALISIR	;YUKSELEN KENAR DEGIL, DUSEN KENAR
																							;DIKKAT ET -> GATE BITI 1 !!!
								; VE P3.3=1 OLDUGU SURECE TIMER CALISIR
								; P3.3=0 OLDUGUNDA SAYMA ISLEMI DURUR.
								
		MOV		DPTR,#-5000		;5MS IçIN GEREKEN SüRE
		MOV		TL1,DPL
		MOV		TH1,DPH
		SETB	ET1			   ; ZAMANLAYICI/SAYICI KESMESI AKTIF
		SETB	EX1  		   ; HARICI KESME AKTIF; 
		SETB	IT1 		   ; DUSEN KENAR KESMELI,	P3.3=1 DEN 0 GECIS KESME OLUSTURACAK
		SETB	EA             ; KESMELER CALISABILIR.
		SETB	PT1			   ; ZAMANLAYICI KESMESI ONCELIKLI	
		CLR		P2.0
		CLR		P2.1
		SETB	TR1			   ; TIMER CALISTI
		CLR		00H 	 	   ; BIT BOLEGESI 00H SILINDI	
		X: SJMP X
    ; BURADAKI SONSUZ DONGUDE P3.3=1 OLMUSSA TIMER CALISIYOR DEMEKTIR.
    ; BURADA P3.3=1'DEN 0 GECINCE HARICI KESME OLUSUR
    ; BURADA TIMER 65535+1 OLUNCA TIMER KESMESI OLUSUR
      ; BU DURUMDA ZATEN KUTU BOYUTU>=5MS'DIR	
	

TIMER1ISR:
	SETB	00H 	; KUTU>=5MS'DIR.
				    ; KUTU GECISI BITTIGINDE DIS KESMEDE LED AYARLARINI YAPACAGIZ.
	RETI
	
HARICI1ISR:
	; DIS KESME GELDI
	MOV		TL1,DPL
	MOV		TH1,DPH
	JNB		00H,KISA   ; BIT 0 ISE DALLAN
						; AKSI TAKDIRDE KUTU UZUN
	CLR		00H         ; ISLEMLER BASA DONECEGINDEN BIT BOLGESI 00H TEMIZLE
	SETB	P2.1
	CLR		P2.1
	RETI
  
KISA:	
	SETB	P2.0
	CLR		P2.0
	RETI
	
	
	END
